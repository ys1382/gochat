syntax = "proto3";

option go_package = "main";

message Login {
    string username = 1;
}

message Contact {
    string name = 1;
    bool online = 2;
}

message Text {
    string body = 1;
}

message File {
    string key = 1;
    bytes data = 2;
}

message Call {
    string key = 1;
    string to = 2;
    string from = 3;
    bool audio = 4;
    bool video = 5;
}

message Time {
    int64 value = 1;
    int32 scale = 2;
    uint32 flags = 3;
    int64 epoch = 4;
}

message Timestamp {
    Time duration = 1;
    Time presentation = 2;
}

message Image {
    int64 width = 1;
    int64 height = 2;
    uint32 format = 3;
    map <string, string> attachments = 4;
    bytes data = 5;
}

message FormatDescription {
    uint32 mediaType = 1;
    uint32 mediaSubtype = 2;
    map <string, string> extensions = 3;
}

message VideoSample {
    Image image = 1;
}

message AudioSample {
    Image image = 1;
}

message Av {
    VideoSample video = 1;
    AudioSample audio = 2;
}

message AVSession {
    string sid = 1;
    string gid = 2;
    bool active = 3;
    bytes data = 4;
}

message AVQuality {
    int32 diff = 1;
}

message Haber {

    uint32 version = 1;
    string sessionId = 2;
    string from = 3;
    string to = 4;

    // Identifies which field is filled in
    enum Which {
        LOGIN = 0;
        CONTACTS = 1;
        PRESENCE = 2;
        TEXT = 3;
        FILE = 4;
        AV = 5;
        AudioSession = 6;
        VideoSession = 7;
        CALL_PROPOSAL = 8;
        CALL_CANCEL = 9;
        CALL_ACCEPT = 10;
        CALL_DECLINE = 11;
        CALL_START_OUTGOING = 12;
        CALL_START_INCOMING = 13;
        CALL_QUALITY = 14;
        CALL_STOP = 15;
    }
    Which which = 15;

    // One of the following will be filled in
    Login login = 101;
    repeated Contact contacts = 102; // for roster, presence, and invite
    Text text = 104;
    File file = 105;
    Call call = 106;
    Av av = 107;
    AVSession audioSession = 108;
    AVSession videoSession = 109;
    AVQuality avQuality = 110;
}
